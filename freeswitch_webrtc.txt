# Bind the AWS EC2 public IP to your domain name
# Install web server
sudo apt install -y apache2

# Browse your domain to see if the website is working
# Read www.letsencrypt.org
# Go to https://certbot.eff.org/instructions?ws=apache&os=ubuntufocal, then follow the instructions

sudo apt -y install snapd
sudo snap install core
sudo snap refresh core
sudo apt-get remove  certbot
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot
sudo certbot --apache

# It will show: Successfully deployed certificate for your_domain to /etc/apache2/sites-enabled/000-default-le-ssl.conf
# Check your https website by https://your_domain

# Optional:
sudo certbot renew --dry-run

# Set up wws
cd /etc/letsencrypt
sudo cp  archive/your_domain/cert1.pem /usr/local/freeswitch/certs/ 
sudo cp  archive/your_domain/chain1.pem  /usr/local/freeswitch/certs/ 
sudo cp  archive/your_domain/fullchain1.pem  /usr/local/freeswitch/certs/ 
sudo cp  archive/your_domain/privkey1.pem  /usr/local/freeswitch/certs/ 

cd ~
mkdir certs
cd certs
sudo cat /usr/local/freeswitch/certs/fullchain1.pem /usr/local/freeswitch/certs/privkey1.pem > /usr/local/freeswitch/certs/wss.pem 
#OR
sudo cat /usr/local/freeswitch/certs/fullchain1.pem /usr/local/freeswitch/certs/privkey1.pem > wss.pem ; sudo cp wss.pem  /usr/local/freeswitch/certs/wss.pem 

sudo cat /usr/local/freeswitch/certs/cert1.pem /usr/local/freeswitch/certs/privkey1.pem > /usr/local/freeswitch/certs/agent.pem 
#OR
sudo cat /usr/local/freeswitch/certs/cert1.pem /usr/local/freeswitch/certs/privkey1.pem > agent.pem ; sudo cp agent.pem /usr/local/freeswitch/certs/agent.pem 

sudo cat /usr/local/freeswitch/certs/chain1.pem > cafile.pem ; sudo cp cafile.pem  /usr/local/freeswitch/certs/cafile.pem 

apt-get update 
apt-get install -y apache2 ca-certificates 
a2enmod ssl 
sudo a2ensite default-ssl.conf 
sudo perl -i -pe 's|/etc/ssl/certs/ssl-cert-snakeoil.pem|/usr/local/freeswitch/certs/cert1.pem|g'   /etc/apache2/sites-enabled/default-ssl.conf 
sudo perl -i -pe 's|/etc/ssl/private/ssl-cert-snakeoil.key|/usr/local/freeswitch/certs/privkey1.pem|g' /etc/apache2/sites-enabled/default-ssl.conf 
sudo service apache2 restart 
# Check /etc/apache2/sites-enabled/default-ssl.conf
# SSLCertificateFile /etc/letsencrypt/live/your_domain/fullchain.pem
# SSLCertificateKeyFile /etc/letsencrypt/live/your_domain/privkey.pem

# Check /usr/local/freeswitch/conf/autoload_configs/verto.conf.xml
<param name="bind-local" value="$${local_ip_v4}:8082" secure="true"/> 
<param name="ext-rtp-ip" value="$${external_rtp_ip}"/>

# Check  /usr/local/freeswitch/conf/sip_profiles/internal.xml
<param name="wss-binding" value=":7443"/> 
<param name="ext-rtp-ip" value="$${external_rtp_ip}"/>
<param name="ext-sip-ip" value="$${external_sip_ip}"/>
sudo systemctl restart freeswitch.service

# Install Verto Communicator, WebRTC Client
cd /usr/src 
# Optional
# begin
#git config --global url."https://".insteadOf git:// 
#git clone https://freeswitch.org/stash/scm/fs/freeswitch.git -bv1.10 freeswitch 
# end

cd /usr/src/freeswitch-1.10.3.-release/html5/verto/verto_communicator/ 
#Optional
cat debian8-install.sh 
#begin
#!/bin/bash
apt-get update
apt-get -y install npm nodejs-legacy
npm install -g grunt grunt-cli bower
npm install
bower --allow-root install
grunt build
#end

sudo apt-get -y install npm grunt
sudo npm install grunt time-grunt jit-grunt grunt-cli autoprefixer-core connect-logger jshint-stylish grunt-git-revision grunt-preprocess
sudo ./debian8-install.sh  
sudo ln -s /usr/src/freeswitch/html5/verto/verto_communicator/dist /var/www/html/vc 
 



