# Bind the AWS EC2 public IP to your domain name
# Install web server
sudo apt install -y apache2

# Browse your domain to see if the website is working
# Read www.letsencrypt.org
# Go to https://certbot.eff.org/instructions?ws=apache&os=ubuntufocal, then follow the instructions

sudo apt -y install snapd
sudo snap install core
sudo snap refresh core
sudo apt-get remove  certbot
sudo snap install --classic certbot
sudo ln -s /snap/bin/certbot /usr/bin/certbot
sudo certbot --apache

# Check your https website by https://your_domain

# Optional:
sudo certbot renew --dry-run

# Set up wws
cd /etc/letsencrypt
sudo cp  archive/your_domain/cert1.pem /usr/local/freeswitch/certs/ 
sudo cp  archive/your_domain/chain1.pem  /usr/local/freeswitch/certs/ 
sudo cp  archive/your_domain/fullchain1.pem  /usr/local/freeswitch/certs/ 
sudo cp  archive/your_domain/privkey1.pem  /usr/local/freeswitch/certs/ 

cd ~
mkdir certs
cd certs
sudo cat /usr/local/freeswitch/certs/fullchain1.pem /usr/local/freeswitch/certs/privkey1.pem > /usr/local/freeswitch/certs/wss.pem 
#OR
sudo cat /usr/local/freeswitch/certs/fullchain1.pem /usr/local/freeswitch/certs/privkey1.pem > wss.pem ; sudo cp wss.pem  /usr/local/freeswitch/certs/wss.pem 

sudo cat /usr/local/freeswitch/certs/cert1.pem /usr/local/freeswitch/certs/privkey1.pem > /usr/local/freeswitch/certs/agent.pem 
#OR
sudo cat /usr/local/freeswitch/certs/cert1.pem /usr/local/freeswitch/certs/privkey1.pem > agent.pem ; sudo cp agent.pem /usr/local/freeswitch/certs/agent.pem 

sudo cat /usr/local/freeswitch/certs/chain1.pem > cafile.pem ; sudo cp cafile.pem  /usr/local/freeswitch/certs/cafile.pem 

apt-get update 
apt-get install -y apache2 ca-certificates 
a2enmod ssl 
sudo a2ensite default-ssl.conf 
sudo perl -i -pe 's|/etc/ssl/certs/ssl-cert-snakeoil.pem|/usr/local/freeswitch/certs/cert.pem|g'  /etc/apache2/sites-enabled/default-ssl.conf 
sudo perl -i -pe 's|/etc/ssl/private/ssl-cert-snakeoil.key|/usr/local/freeswitch/certs/privkey.pem|g' /etc/apache2/sites-enabled/default-ssl.conf 
sudo service apache2 restart 

