# Route traffic over IPSec

# Route the traffic from site1(172.16.1.0/24) to site2(10.10.1.0/24), then to 10.10.2.0/24
sudo sysctl -w net.ipv4.ip_forward=1
sudo iptables -t nat -A POSTROUTING -s 172.16.10.0/24 -j MASQUERADE
# OR
sudo iptables -t nat -A POSTROUTING  -s 172.16.1.100 -d 10.10.2.0/24 -o eth0 -j MASQUERADE

# Check rulres are expected by
sudo iptables -S (or -L)
sudo iptables -t nat -S


#OR:
sudo sysctl -w net.ipv4.ip_forward=1
sudo iptables -t nat -A POSTROUTING -d 192.168.10.13 -j MASQUERADE

# If it needs to route the remote access VPN(user vpn) to site to site vpn, the leftsubnets should be overlapped. In the client side, it needs to make the routes correct too, e.g.  sudo route -n add -net 10.0.0.0/8 ipsec_virtual_ip


# With the virtual network interface for the route-based e.g. GRE/vti
Box1:
sudo sysctl -w net.ipv4.ip_forward=1
sudo ip tunnel add tunnel100 mode gre local your_local_ip remote the_peer_IP ttl 255 dev enp0s8 
sudo ip addr add 192.168.100.1 dev tunnel100 peer 192.168.200.0/24
sudo ip route add 10.0.4.0/24 dev tunnel100
sudo ip link set dev tunnel100 up


